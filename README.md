# Uniswap V3 æµåŠ¨æ€§åˆ†æå™¨

ä¸€ä¸ªç”¨äºåˆ†æ Uniswap V3 æ± å­æµåŠ¨æ€§åˆ†å¸ƒçš„å·¥å…·ï¼ŒåŒ…å«åç«¯æ•°æ®æ”¶é›†æœåŠ¡å’Œå‰ç«¯åˆ†æç•Œé¢ã€‚

## ğŸš€ æ–°ç‰¹æ€§

- **ç²¾ç¡®çš„æµåŠ¨æ€§è®¡ç®—**: ä½¿ç”¨ Uniswap V3 çš„ç²¾ç¡®å…¬å¼è®¡ç®— tick ä½ç½®å¯¹åº”çš„ä»£å¸æ•°é‡
- **æ™ºèƒ½æ± å­åœ°å€è®¡ç®—**: æ ¹æ® token0ã€token1 å’Œè´¹ç‡è‡ªåŠ¨è®¡ç®—æ± å­åœ°å€
- **å®æ—¶æ•°æ®æ”¶é›†**: å®šæ—¶ä»åŒºå—é“¾èŠ‚ç‚¹æ”¶é›†æµåŠ¨æ€§æ•°æ®
- **ç°ä»£åŒ–æ¶æ„**: ä½¿ç”¨ NestJS + Next.js + TypeScript æ„å»º

## é¡¹ç›®ç»“æ„

```
uniswap-v3-liquidity-analyzer/
â”œâ”€â”€ backend/                 # åç«¯æœåŠ¡ (NestJS + TypeScript)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/         # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ entities/       # æ•°æ®åº“å®ä½“
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ controllers/    # APIæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ utils/          # å·¥å…·ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ uniswap-v3.utils.ts           # Uniswap V3 åŸºç¡€å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ uniswap-v3-liquidity-calculator.ts  # æµåŠ¨æ€§è®¡ç®—å™¨
â”‚   â”‚   â””â”€â”€ main.ts         # ä¸»å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ test/               # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ frontend/                # å‰ç«¯ç•Œé¢ (Next.js + TypeScript)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/            # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/     # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ services/       # APIæœåŠ¡
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ start.sh                 # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ QUICK_START.md          # å¿«é€Ÿå¯åŠ¨æŒ‡å—
â””â”€â”€ README.md               # è¯¦ç»†æ–‡æ¡£
```

## åŠŸèƒ½ç‰¹æ€§

### åç«¯æœåŠ¡
- ğŸ•’ å®šæ—¶ä»åŒºå—é“¾èŠ‚ç‚¹æ”¶é›†æµåŠ¨æ€§æ•°æ®
- ğŸ—„ï¸ æ•°æ®å­˜å‚¨åˆ° PostgreSQL æ•°æ®åº“
- ğŸ”„ è‡ªåŠ¨è®¡ç®—æ± å­åœ°å€ï¼ˆåŸºäº token0ã€token1 å’Œè´¹ç‡ï¼‰
- ğŸ“Š æä¾› RESTful API æ¥å£
- âš¡ ä½¿ç”¨ NestJS æ¡†æ¶ï¼Œæ”¯æŒå®šæ—¶ä»»åŠ¡
- ğŸ§® **ç²¾ç¡®çš„æµåŠ¨æ€§è®¡ç®—**: ä½¿ç”¨ Uniswap V3 çš„ç²¾ç¡®å…¬å¼è®¡ç®—ä»£å¸æ•°é‡

### å‰ç«¯ç•Œé¢
- ğŸ¨ ç°ä»£åŒ–çš„ React ç•Œé¢
- ğŸ“ˆ æµåŠ¨æ€§åˆ†å¸ƒå›¾è¡¨å±•ç¤º
- ğŸ” æ± å­ç®¡ç†å’Œç›‘æ§
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
- ğŸš€ åŸºäº Next.js 13 App Router

## æŠ€æœ¯æ ˆ

### åç«¯
- **æ¡†æ¶**: NestJS
- **è¯­è¨€**: TypeScript
- **æ•°æ®åº“**: PostgreSQL + TypeORM
- **åŒºå—é“¾**: Ethers.js + Uniswap SDK
- **å®šæ—¶ä»»åŠ¡**: @nestjs/schedule
- **æµ‹è¯•**: Jest + Chai

### å‰ç«¯
- **æ¡†æ¶**: Next.js 13
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: Tailwind CSS
- **å›¾è¡¨**: Chart.js + react-chartjs-2
- **UIç»„ä»¶**: Headless UI + Heroicons

## æ ¸å¿ƒç®—æ³•

### æµåŠ¨æ€§è®¡ç®—å™¨
é¡¹ç›®åŒ…å«ä¸€ä¸ªä¸“é—¨çš„ `UniswapV3LiquidityCalculator` ç±»ï¼Œå®ç°äº†ï¼š

1. **ç²¾ç¡®çš„ Tick ä»·æ ¼è®¡ç®—**: ä½¿ç”¨ Uniswap V3 çš„ç²¾ç¡®å…¬å¼è®¡ç®—æ¯ä¸ª tick å¯¹åº”çš„ sqrt price
2. **ä»£å¸æ•°é‡è®¡ç®—**: æ ¹æ®æµåŠ¨æ€§ã€ä»·æ ¼èŒƒå›´å’Œå½“å‰ä»·æ ¼è®¡ç®— token0 å’Œ token1 çš„æ•°é‡
3. **æ€»æµåŠ¨æ€§åˆ†æ**: æ‰«ææ‰€æœ‰åˆå§‹åŒ–çš„ ticksï¼Œç´¯ç§¯è®¡ç®—æ€»ä»£å¸æ•°é‡
4. **æ´»è·ƒæµåŠ¨æ€§èŒƒå›´**: æ‰¾åˆ°å½“å‰ä»·æ ¼é™„è¿‘çš„æ´»è·ƒæµåŠ¨æ€§èŒƒå›´

### å…³é”®æ–¹æ³•
- `getSqrtRatioAtTick(tick)`: è®¡ç®—æŒ‡å®š tick çš„ sqrt price
- `calculateTokenAmountsInRange()`: è®¡ç®—ç‰¹å®šèŒƒå›´å†…çš„ä»£å¸æ•°é‡
- `calculateTotalTokenAmounts()`: è®¡ç®—æ± å­ä¸­æ‰€æœ‰ä»£å¸çš„æ€»æ•°é‡
- `findActiveLiquidityRange()`: æ‰¾åˆ°æ´»è·ƒæµåŠ¨æ€§èŒƒå›´

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- PostgreSQL 12+
- Docker (å¯é€‰ï¼Œç”¨äºå¿«é€Ÿå¯åŠ¨æ•°æ®åº“)
- ä»¥å¤ªåŠèŠ‚ç‚¹è®¿é—®æƒé™

### 1. ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰
```bash
# ç¡®ä¿ Docker å·²å¯åŠ¨
./start.sh
```

### 2. æ‰‹åŠ¨å¯åŠ¨
```bash
# å¯åŠ¨æ•°æ®åº“
docker run -d \
    --name uniswap-v3-postgres \
    -e POSTGRES_DB=uniswap_v3_analyzer \
    -e POSTGRES_USER=postgres \
    -e POSTGRES_PASSWORD=password \
    -p 5432:5432 \
    postgres:13

# é…ç½®ç¯å¢ƒå˜é‡
cd backend && cp env.example .env
cd ../frontend && cp env.local .env.local

# å¯åŠ¨åç«¯
cd backend && npm install && npm run start:dev

# å¯åŠ¨å‰ç«¯
cd frontend && npm install && npm run dev
```

## API æ¥å£

### æ± å­ç®¡ç†
- `POST /pools` - åˆ›å»ºæ–°æ± å­
- `GET /pools` - è·å–æ‰€æœ‰æ± å­
- `GET /pools/:address` - è·å–æŒ‡å®šæ± å­ä¿¡æ¯
- `PUT /pools/:address/status` - æ›´æ–°æ± å­çŠ¶æ€
- `DELETE /pools/:address` - åˆ é™¤æ± å­

### æµåŠ¨æ€§æ•°æ®
- `GET /liquidity/pool/:poolAddress` - è·å–æ± å­æµåŠ¨æ€§æ•°æ®
- `GET /liquidity/pool/:poolAddress/stats` - è·å–æµåŠ¨æ€§ç»Ÿè®¡
- `GET /liquidity/pool/:poolAddress/distribution` - è·å–æµåŠ¨æ€§åˆ†å¸ƒ

## ä½¿ç”¨è¯´æ˜

### 1. æ·»åŠ æ± å­
1. åœ¨å‰ç«¯ç•Œé¢ç‚¹å‡»"æ·»åŠ æ± å­"æŒ‰é’®
2. è¾“å…¥ä¸¤ä¸ªä»£å¸çš„åˆçº¦åœ°å€
3. é€‰æ‹©è´¹ç‡ç­‰çº§ï¼ˆ0.05%, 0.3%, 1%ï¼‰
4. ç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—æ± å­åœ°å€å¹¶å¼€å§‹ç›‘æ§

### 2. ç›‘æ§æµåŠ¨æ€§
- åç«¯æœåŠ¡ä¼šå®šæ—¶æ”¶é›†æµåŠ¨æ€§æ•°æ®
- ä½¿ç”¨ç²¾ç¡®çš„ç®—æ³•è®¡ç®—æ¯ä¸ª tick çš„ä»£å¸æ•°é‡
- æ•°æ®è‡ªåŠ¨å­˜å‚¨åˆ°æ•°æ®åº“
- å¯é€šè¿‡å‰ç«¯ç•Œé¢æŸ¥çœ‹å®æ—¶æ•°æ®

### 3. åˆ†ææ•°æ®
- æŸ¥çœ‹æµåŠ¨æ€§åˆ†å¸ƒå›¾è¡¨
- åˆ†æä»·æ ¼åŒºé—´åˆ†å¸ƒ
- ç›‘æ§æµåŠ¨æ€§å˜åŒ–è¶‹åŠ¿
- æŸ¥çœ‹ç²¾ç¡®çš„ä»£å¸æ•°é‡è®¡ç®—

## å¼€å‘

### åç«¯å¼€å‘
```bash
cd backend
npm run start:dev      # å¼€å‘æ¨¡å¼
npm run build          # æ„å»º
npm run start:prod     # ç”Ÿäº§æ¨¡å¼
npm test               # è¿è¡Œæµ‹è¯•
```

### å‰ç«¯å¼€å‘
```bash
cd frontend
npm run dev            # å¼€å‘æ¨¡å¼
npm run build          # æ„å»º
npm run start          # ç”Ÿäº§æ¨¡å¼
```

### è¿è¡Œæµ‹è¯•
```bash
cd backend
npm test               # è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:watch     # ç›‘å¬æ¨¡å¼
npm run test:cov       # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```

## éƒ¨ç½²

### ç”Ÿäº§ç¯å¢ƒé…ç½®
1. ä¿®æ”¹ç¯å¢ƒå˜é‡é…ç½®
2. å…³é—­æ•°æ®åº“åŒæ­¥æ¨¡å¼
3. é…ç½®åå‘ä»£ç†
4. è®¾ç½® SSL è¯ä¹¦

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t uniswap-v3-analyzer-backend ./backend
docker build -t uniswap-v3-analyzer-frontend ./frontend

# è¿è¡Œå®¹å™¨
docker run -d -p 3001:3001 uniswap-v3-analyzer-backend
docker run -d -p 3000:3000 uniswap-v3-analyzer-frontend
```

## ç®—æ³•è¯´æ˜

### æµåŠ¨æ€§è®¡ç®—åŸç†
1. **æ‰«æåˆå§‹åŒ– Ticks**: ä»å½“å‰ä»·æ ¼é™„è¿‘æ‰«ææ‰€æœ‰å·²åˆå§‹åŒ–çš„ ticks
2. **ç´¯ç§¯æµåŠ¨æ€§**: ä½¿ç”¨ `liquidityNet` ç´¯ç§¯è®¡ç®—æ¯ä¸ªä»·æ ¼åŒºé—´çš„æ´»è·ƒæµåŠ¨æ€§
3. **ä»£å¸æ•°é‡è®¡ç®—**: æ ¹æ®ä»·æ ¼èŒƒå›´å’Œå½“å‰ä»·æ ¼ï¼Œä½¿ç”¨ Uniswap V3 çš„ç²¾ç¡®å…¬å¼è®¡ç®—ä»£å¸æ•°é‡
4. **ç»“æœæ±‡æ€»**: æ±‡æ€»æ‰€æœ‰ä»·æ ¼åŒºé—´çš„ä»£å¸æ•°é‡ï¼Œå¾—åˆ°æ± å­ä¸­çš„æ€»ä»£å¸æ•°é‡

### ä¼˜åŠ¿
- **ç²¾ç¡®æ€§**: ä½¿ç”¨ Uniswap V3 çš„å®˜æ–¹å…¬å¼ï¼Œç¡®ä¿è®¡ç®—å‡†ç¡®æ€§
- **æ•ˆç‡**: åªæ‰«æå·²åˆå§‹åŒ–çš„ ticksï¼Œé¿å…æ— æ•ˆè®¡ç®—
- **å®æ—¶æ€§**: æ”¯æŒå®æ—¶æ•°æ®æ›´æ–°å’Œè®¡ç®—
- **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•æ–°åŠŸèƒ½

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

MIT License
